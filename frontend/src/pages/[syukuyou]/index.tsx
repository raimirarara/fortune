import Head from "next/head";
import Image from "next/image";
import "dayjs/locale/ja";
import { css } from "@emotion/react";
import { Inter } from "@next/font/google";
import styles from "@/styles/Home.module.css";
import { useEffect, useState } from "react";
import dayjs from "dayjs";
import { useRouter } from "next/router";
import RelationSanku from "public/relation_sanku.png";
import RelationYado from "public/relation_yado.png";
import { CalendarInfo } from "@/entities/CalendarInfo";
import { Button, Container, Text, Title, createStyles } from "@mantine/core";

const ASTROLOGY27 = [
  "昴宿",
  "畢宿",
  "觜宿",
  "参宿",
  "井宿",
  "鬼宿",
  "柳宿",
  "星宿",
  "張宿",
  "翼宿",
  "軫宿",
  "角宿",
  "亢宿",
  "底宿",
  "房宿",
  "心宿",
  "尾宿",
  "箕宿",
  "斗宿",
  "女宿",
  "虚宿",
  "危宿",
  "室宿",
  "壁宿",
  "奎宿",
  "婁宿",
  "胃宿",
];

const useStyles = createStyles((theme) => ({
  wrapper: {
    position: "relative",
    paddingTop: 120,
    paddingBottom: 80,

    "@media (max-width: 755px)": {
      paddingTop: 80,
      paddingBottom: 60,
    },
  },

  inner: {
    position: "relative",
    zIndex: 1,
  },

  title: {
    textAlign: "center",
    fontWeight: 800,
    fontSize: 40,
    letterSpacing: -1,
    color: theme.colorScheme === "dark" ? theme.white : theme.black,
    marginBottom: theme.spacing.xs,
    fontFamily: `Greycliff CF, ${theme.fontFamily}`,

    "@media (max-width: 520px)": {
      fontSize: 28,
      textAlign: "center",
    },
  },

  highlight: {
    color: theme.colors[theme.primaryColor][theme.colorScheme === "dark" ? 4 : 6],
  },

  description: {
    textAlign: "center",

    "@media (max-width: 520px)": {
      textAlign: "center",
      fontSize: theme.fontSizes.md,
    },
  },

  controls: {
    marginTop: theme.spacing.lg,
    display: "flex",
    justifyContent: "center",
  },
}));

export default function Result() {
  const router = useRouter();
  const { classes } = useStyles();
  const [myShukuyou, setShukuyou] = useState(router.query.syukuyou as string);
  const rotateAngle = ASTROLOGY27.indexOf(myShukuyou) * 13.35;

  useEffect(() => {
    // reload時にもう一度setする
    if (router.query.syukuyou) {
      setShukuyou(router.query.syukuyou as string);
    }
  }, [router.query.syukuyou]);

  return (
    <>
      <Head>
        <title>{myShukuyou}</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={styles.main}>
        <Title className={classes.title}>
          <Text component="span" className={classes.highlight} inherit>
            {myShukuyou}
          </Text>
        </Title>

        <Container p={0} size={600}>
          <Text size="lg" color="dimmed" className={classes.description}>
            宿曜占星術
          </Text>
        </Container>

        <div className={classes.controls}>
          <Image
            css={css`
              position: absolute;
            `}
            width={350}
            src={RelationSanku}
            alt="relation_sanku"
          />
          <Image
            css={css`
              transform: rotate(${rotateAngle}deg);
            `}
            width={350}
            src={RelationYado}
            alt="relation_yado"
          />
        </div>
        <Button
          variant="gradient"
          gradient={{ from: "#ed6ea0", to: "#ec8c69", deg: 35 }}
          size="md"
          onClick={() => router.push("/")}
        >
          もどる
        </Button>
      </main>
    </>
  );
}
